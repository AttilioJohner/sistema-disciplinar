<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - Dashboard Disciplinar</title>
    
    <!-- CSS Externos -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>

<body>
    <!-- BARRA SUPERIOR -->
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="app-launcher">
                <span></span><span></span><span></span>
                <span></span><span></span><span></span>
                <span></span><span></span><span></span>
            </div>
            <span class="app-name">Dashboard Disciplinar</span>
        </div>
        <div class="top-bar-center">
            <input type="text" class="search-box" placeholder="Pesquisar configura√ß√µes...">
        </div>
        <div class="top-bar-right">
            <div class="user-profile">A</div>
        </div>
    </div>

    <!-- LAYOUT PRINCIPAL -->
    <div class="main-layout">
        
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">M√≥dulos Principais</div>
                
                <a href="../index.html" class="sidebar-item">
                    <span class="sidebar-icon">üè†</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                
                <a href="controle-disciplinar.html" class="sidebar-item">
                    <span class="sidebar-icon">‚öñÔ∏è</span>
                    <span class="sidebar-text">Controle Disciplinar</span>
                </a>
                
                <a href="gestao-alunos.html" class="sidebar-item">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-text">Gest√£o de Alunos</span>
                </a>
                
                <a href="medidas-disciplinares.html" class="sidebar-item">
                    <span class="sidebar-icon">üìã</span>
                    <span class="sidebar-text">Medidas Disciplinares</span>
                </a>
                
                <a href="frequencia.html" class="sidebar-item">
                    <span class="sidebar-icon">üìÖ</span>
                    <span class="sidebar-text">Frequ√™ncia</span>
                </a>
                
                <a href="relatorios.html" class="sidebar-item">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">Relat√≥rios</span>
                </a>
                
                <a href="analises.html" class="sidebar-item">
                    <span class="sidebar-icon">üìà</span>
                    <span class="sidebar-text">An√°lises</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Ferramentas</div>
                
                <a href="configuracoes.html" class="sidebar-item active">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span class="sidebar-text">Configura√ß√µes</span>
                </a>
                
                <a href="comunicacao.html" class="sidebar-item">
                    <span class="sidebar-icon">üì±</span>
                    <span class="sidebar-text">Comunica√ß√£o</span>
                </a>
                
                <a href="login.html" class="sidebar-item">
                    <span class="sidebar-icon">üîê</span>
                    <span class="sidebar-text">Login/Logout</span>
                </a>
            </div>
        </div>

        <!-- √ÅREA DE CONTE√öDO -->
        <div class="content-area">
            <div class="main-content">
                
                <!-- T√çTULO -->
                <div class="module-title">
                    ‚öôÔ∏è Configura√ß√µes do Sistema
                </div>

                <!-- CONFIGURA√á√ïES GERAIS -->
                <div class="config-section">
                    <div class="config-title">üè´ Configura√ß√µes da Escola</div>
                    <div class="config-grid">
                        <div class="config-item">
                            <label class="config-label">Nome da Escola:</label>
                            <input type="text" id="nomeEscola" class="config-input" placeholder="Digite o nome da escola">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Ano Letivo:</label>
                            <input type="number" id="anoLetivo" class="config-input" value="2025" min="2020" max="2030">
                        </div>
                        <div class="config-item">
                            <label class="config-label">CNPJ/C√≥digo MEC:</label>
                            <input type="text" id="cnpjEscola" class="config-input" placeholder="00.000.000/0001-00">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Endere√ßo:</label>
                            <input type="text" id="enderecoEscola" class="config-input" placeholder="Endere√ßo completo">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Telefone:</label>
                            <input type="tel" id="telefoneEscola" class="config-input" placeholder="(11) 99999-9999">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Email Institucional:</label>
                            <input type="email" id="emailEscola" class="config-input" placeholder="contato@escola.edu.br">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="salvarConfiguracoesEscola()">
                        üíæ Salvar Configura√ß√µes da Escola
                    </button>
                </div>

                <!-- CONFIGURA√á√ïES DO SISTEMA -->
                <div class="config-section">
                    <div class="config-title">üîß Configura√ß√µes do Sistema</div>
                    <div class="config-grid">
                        <div class="config-item">
                            <label class="config-label">Limite de Faltas para Alerta:</label>
                            <input type="number" id="limiteFaltas" class="config-input" value="10" min="1" max="50">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Dias para Backup Autom√°tico:</label>
                            <input type="number" id="diasBackup" class="config-input" value="7" min="1" max="30">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Formato de Data:</label>
                            <select id="formatoData" class="config-input">
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Tema do Sistema:</label>
                            <select id="temaSistema" class="config-input">
                                <option value="claro">Tema Claro</option>
                                <option value="escuro">Tema Escuro</option>
                                <option value="auto">Autom√°tico</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Notifica√ß√µes por Email:</label>
                            <select id="notificacoesEmail" class="config-input">
                                <option value="todas">Todas as Notifica√ß√µes</option>
                                <option value="importantes">Apenas Importantes</option>
                                <option value="nenhuma">Desabilitadas</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Idioma do Sistema:</label>
                            <select id="idiomaSistema" class="config-input">
                                <option value="pt-BR">Portugu√™s (Brasil)</option>
                                <option value="en-US">English (US)</option>
                                <option value="es-ES">Espa√±ol</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="salvarConfigracoesSistema()">
                        ‚öôÔ∏è Salvar Configura√ß√µes do Sistema
                    </button>
                </div>

                <!-- CONFIGURA√á√ïES DE SEGURAN√áA -->
                <div class="config-section">
                    <div class="config-title">üîí Configura√ß√µes de Seguran√ßa</div>
                    <div class="config-grid">
                        <div class="config-item">
                            <label class="config-label">Tempo de Sess√£o (minutos):</label>
                            <input type="number" id="tempoSessao" class="config-input" value="60" min="15" max="480">
                        </div>
                        <div class="config-item">
                            <label class="config-label">Pol√≠tica de Senhas:</label>
                            <select id="politicaSenhas" class="config-input">
                                <option value="basica">B√°sica (6+ caracteres)</option>
                                <option value="intermediaria">Intermedi√°ria (8+ com n√∫meros)</option>
                                <option value="avancada">Avan√ßada (12+ com s√≠mbolos)</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Autentica√ß√£o de Dois Fatores:</label>
                            <select id="autenticacao2FA" class="config-input">
                                <option value="desabilitada">Desabilitada</option>
                                <option value="opcional">Opcional</option>
                                <option value="obrigatoria">Obrigat√≥ria</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Log de Atividades:</label>
                            <select id="logAtividades" class="config-input">
                                <option value="completo">Completo</option>
                                <option value="basico">B√°sico</option>
                                <option value="desabilitado">Desabilitado</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="salvarConfiguracoeSeguranca()">
                        üîí Salvar Configura√ß√µes de Seguran√ßa
                    </button>
                </div>

                <!-- GERENCIAMENTO DE DADOS -->
                <div class="config-section">
                    <div class="config-title">üíæ Gerenciamento de Dados</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Backup dos Dados</label>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                                Fa√ßa backup regular dos dados para evitar perdas
                            </p>
                            <button class="btn btn-info" onclick="fazerBackupCompleto()">
                                üíæ Fazer Backup Completo
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Restaurar Dados</label>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                                Restaurar dados a partir de um arquivo de backup
                            </p>
                            <input type="file" id="arquivoRestore" accept=".json" class="form-input" style="margin-bottom: 10px;">
                            <button class="btn btn-warning" onclick="restaurarBackup()">
                                üìÇ Restaurar Backup
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Exportar Dados</label>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                                Exportar todos os dados em formato CSV
                            </p>
                            <button class="btn btn-success" onclick="exportarTodosDados()">
                                üìä Exportar Tudo (CSV)
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Limpeza de Dados</label>
                            <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                                ‚ö†Ô∏è <strong>CUIDADO:</strong> A√ß√£o irrevers√≠vel
                            </p>
                            <button class="btn btn-secondary" onclick="limparDadosAntigos()">
                                üóëÔ∏è Limpar Dados Antigos
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURA√á√ïES FIREBASE -->
                <div class="config-section">
                    <div class="config-title">üî• Configura√ß√µes Firebase</div>
                    <div class="config-grid">
                        <div class="config-item">
                            <label class="config-label">Status da Conex√£o:</label>
                            <div id="statusFirebase" style="padding: 10px; border-radius: 4px; margin-top: 5px;">
                                <span id="statusTexto">Verificando...</span>
                                <button class="btn btn-small btn-info" onclick="testarConexaoFirebase()" style="margin-left: 10px;">
                                    üîÑ Testar Conex√£o
                                </button>
                            </div>
                        </div>
                        <div class="config-item">
                            <label class="config-label">Projeto ID:</label>
                            <input type="text" id="projectId" class="config-input" placeholder="seu-projeto-firebase" readonly>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                        <p style="margin-bottom: 10px;"><strong>üìñ Como configurar Firebase:</strong></p>
                        <ol style="margin-left: 20px; line-height: 1.6;">
                            <li>Acesse <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                            <li>Crie um novo projeto ou selecione um existente</li>
                            <li>Ative o Firestore Database</li>
                            <li>Configure as regras de seguran√ßa</li>
                            <li>Copie as configura√ß√µes para <code>assets/js/firebase-config.js</code></li>
                        </ol>
                    </div>
                </div>

                <!-- SOBRE O SISTEMA -->
                <div class="config-section">
                    <div class="config-title">‚ÑπÔ∏è Sobre o Sistema</div>
                    <div class="student-stats" style="margin-bottom: 20px;">
                        <div class="stat-box">
                            <div class="stat-number">v1.0</div>
                            <div class="stat-label">Vers√£o</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="totalRegistros">0</div>
                            <div class="stat-label">Registros</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="espacoUsado">0 MB</div>
                            <div class="stat-label">Espa√ßo Usado</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="ultimoBackup">Nunca</div>
                            <div class="stat-label">√öltimo Backup</div>
                        </div>
                    </div>
                    <p style="color: #666; line-height: 1.6;">
                        <strong>Dashboard Disciplinar v1.0</strong><br>
                        Sistema de gest√£o disciplinar escolar desenvolvido para facilitar o controle de faltas, 
                        medidas disciplinares e comunica√ß√£o com respons√°veis. 
                        Desenvolvido com HTML5, CSS3, JavaScript e Firebase.
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script src="../assets/js/main.js" defer></script>
    
    <script>
        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚öôÔ∏è P√°gina de Configura√ß√µes carregada');
            inicializarConfiguracoes();
        });

        // Fun√ß√£o de inicializa√ß√£o
        function inicializarConfiguracoes() {
            carregarConfiguracoesSalvas();
            verificarStatusFirebase();
            atualizarEstatisticasSistema();
        }

        // Carregar configura√ß√µes salvas
        function carregarConfiguracoesSalvas() {
            // Carregar do localStorage
            const configs = {
                nomeEscola: localStorage.getItem('nomeEscola') || '',
                anoLetivo: localStorage.getItem('anoLetivo') || new Date().getFullYear(),
                cnpjEscola: localStorage.getItem('cnpjEscola') || '',
                enderecoEscola: localStorage.getItem('enderecoEscola') || '',
                telefoneEscola: localStorage.getItem('telefoneEscola') || '',
                emailEscola: localStorage.getItem('emailEscola') || '',
                limiteFaltas: localStorage.getItem('limiteFaltas') || '10',
                diasBackup: localStorage.getItem('diasBackup') || '7',
                formatoData: localStorage.getItem('formatoData') || 'DD/MM/YYYY',
                temaSistema: localStorage.getItem('temaSistema') || 'claro',
                notificacoesEmail: localStorage.getItem('notificacoesEmail') || 'importantes',
                idiomaSistema: localStorage.getItem('idiomaSistema') || 'pt-BR',
                tempoSessao: localStorage.getItem('tempoSessao') || '60',
                politicaSenhas: localStorage.getItem('politicaSenhas') || 'basica',
                autenticacao2FA: localStorage.getItem('autenticacao2FA') || 'desabilitada',
                logAtividades: localStorage.getItem('logAtividades') || 'basico'
            };

            // Aplicar valores aos campos
            Object.keys(configs).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = configs[key];
                }
            });
        }

        // Verificar status do Firebase
        async function verificarStatusFirebase() {
            const statusElement = document.getElementById('statusFirebase');
            const textoElement = document.getElementById('statusTexto');
            
            if (isFirebaseReady()) {
                try {
                    const conectado = await testarConexaoFirebase();
                    if (conectado) {
                        statusElement.style.backgroundColor = '#d4edda';
                        statusElement.style.color = '#155724';
                        textoElement.textContent = '‚úÖ Conectado';
                        
                        // Mostrar Project ID se dispon√≠vel
                        if (window.firebaseConfig && window.firebaseConfig.projectId) {
                            document.getElementById('projectId').value = window.firebaseConfig.projectId;
                        }
                    } else {
                        throw new Error('Falha na conex√£o');
                    }
                } catch (error) {
                    statusElement.style.backgroundColor = '#f8d7da';
                    statusElement.style.color = '#721c24';
                    textoElement.textContent = '‚ùå Erro na conex√£o';
                }
            } else {
                statusElement.style.backgroundColor = '#fff3cd';
                statusElement.style.color = '#856404';
                textoElement.textContent = '‚ö†Ô∏è Firebase n√£o configurado';
            }
        }

        // Atualizar estat√≠sticas do sistema
        async function atualizarEstatisticasSistema() {
            try {
                let totalRegistros = 0;
                
                if (isFirebaseReady()) {
                    const alunosSnapshot = await db.collection('alunos').get();
                    const faltasSnapshot = await db.collection('faltas').get();
                    const medidasSnapshot = await db.collection('medidas').get();
                    
                    totalRegistros = alunosSnapshot.size + faltasSnapshot.size + medidasSnapshot.size;
                }
                
                document.getElementById('totalRegistros').textContent = totalRegistros;
                
                // Simular espa√ßo usado (estimativa b√°sica)
                const espacoEstimado = Math.round(totalRegistros * 0.5); // 0.5KB por registro
                document.getElementById('espacoUsado').textContent = espacoEstimado + ' KB';
                
                // √öltimo backup
                const ultimoBackup = localStorage.getItem('ultimoBackup') || 'Nunca';
                document.getElementById('ultimoBackup').textContent = ultimoBackup;
                
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
            }
        }

        // Salvar configura√ß√µes
        function salvarConfiguracoesEscola() {
            const configs = {
                nomeEscola: document.getElementById('nomeEscola').value,
                anoLetivo: document.getElementById('anoLetivo').value,
                cnpjEscola: document.getElementById('cnpjEscola').value,
                enderecoEscola: document.getElementById('enderecoEscola').value,
                telefoneEscola: document.getElementById('telefoneEscola').value,
                emailEscola: document.getElementById('emailEscola').value
            };

            try {
                Object.keys(configs).forEach(key => {
                    localStorage.setItem(key, configs[key]);
                });
                showMessage('‚úÖ Configura√ß√µes da escola salvas!', 'success');
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        function salvarConfigracoesSistema() {
            const configs = {
                limiteFaltas: document.getElementById('limiteFaltas').value,
                diasBackup: document.getElementById('diasBackup').value,
                formatoData: document.getElementById('formatoData').value,
                temaSistema: document.getElementById('temaSistema').value,
                notificacoesEmail: document.getElementById('notificacoesEmail').value,
                idiomaSistema: document.getElementById('idiomaSistema').value
            };

            try {
                Object.keys(configs).forEach(key => {
                    localStorage.setItem(key, configs[key]);
                });
                showMessage('‚úÖ Configura√ß√µes do sistema salvas!', 'success');
                
                // Aplicar tema se mudou
                aplicarTema(configs.temaSistema);
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        function salvarConfiguracoeSeguranca() {
            const configs = {
                tempoSessao: document.getElementById('tempoSessao').value,
                politicaSenhas: document.getElementById('politicaSenhas').value,
                autenticacao2FA: document.getElementById('autenticacao2FA').value,
                logAtividades: document.getElementById('logAtividades').value
            };

            try {
                Object.keys(configs).forEach(key => {
                    localStorage.setItem(key, configs[key]);
                });
                showMessage('‚úÖ Configura√ß√µes de seguran√ßa salvas!', 'success');
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        // Fun√ß√µes de dados
        async function fazerBackupCompleto() {
            try {
                await fazerBackup();
                localStorage.setItem('ultimoBackup', new Date().toLocaleDateString('pt-BR'));
                atualizarEstatisticasSistema();
            } catch (error) {
                showMessage('Erro ao fazer backup', 'error');
            }
        }

        function restaurarBackup() {
            showMessage('Funcionalidade em desenvolvimento', 'info');
        }

        function exportarTodosDados() {
            showMessage('Funcionalidade em desenvolvimento', 'info');
        }

        function limparDadosAntigos() {
            if (confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° remover registros antigos permanentemente.\n\nTem certeza que deseja continuar?')) {
                showMessage('Funcionalidade em desenvolvimento', 'info');
            }
        }

        // Aplicar tema
        function aplicarTema(tema) {
            // Implementa√ß√£o b√°sica de tema
            const body = document.body;
            body.classList.remove('tema-claro', 'tema-escuro');
            
            if (tema === 'escuro') {
                body.classList.add('tema-escuro');
            } else if (tema === 'auto') {
                const isEscuro = window.matchMedia('(prefers-color-scheme: dark)').matches;
                body.classList.add(isEscuro ? 'tema-escuro' : 'tema-claro');
            } else {
                body.classList.add('tema-claro');
            }
        }

        // Fun√ß√µes expostas globalmente
        window.salvarConfiguracoesEscola = salvarConfiguracoesEscola;
        window.salvarConfigracoesSistema = salvarConfigracoesSistema;
        window.salvarConfiguracoeSeguranca = salvarConfiguracoeSeguranca;
        window.fazerBackupCompleto = fazerBackupCompleto;
        window.restaurarBackup = restaurarBackup;
        window.exportarTodosDados = exportarTodosDados;
        window.limparDadosAntigos = limparDadosAntigos;
    </script>
    <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Espera o Firebase estar carregado
    const wait = setInterval(() => {
      if (window.isFirebaseReady && window.isFirebaseReady()) {
        clearInterval(wait);

        // Verifica usu√°rio logado
        firebase.auth().onAuthStateChanged(user => {
          if (!user) {
            // Se n√£o est√° logado ‚Üí volta para login
            window.location.href = 'login.html'; 
          } else {
            console.log("Usu√°rio logado:", user.email);
            // Aqui voc√™ pode chamar fun√ß√µes de carregamento da p√°gina
            // Exemplo: carregarAlunos();
          }
        });
      }
    }, 100);
  });
</script>

</body>
</html>
